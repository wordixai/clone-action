name: Revert Commit in Remote Repo

on:
  workflow_dispatch:
    inputs:
      source_repo_url:
        description: 'The GitHub repository URL (e.g., https://github.com/otheruser/otherrepo)'
        required: true
      commit_sha:
        description: 'The commit SHA to revert'
        required: true
      branch:
        description: 'The branch to operate on'
        default: 'main'

jobs:
  revert-remote:
    runs-on: ubuntu-latest
    steps:
      - name: Clone source repository
        run: |
          git clone https://x-access-token:${{ secrets.TARGET_REPO_TOKEN }}@${{ github.event.inputs.source_repo_url }} /tmp/source-repo
          cd /tmp/source-repo
          git checkout ${{ github.event.inputs.branch }}

      - name: Setup Git config
        run: |
          cd /tmp/source-repo
          git config user.name "GitHub Actions Bot"
          git config user.email "actions@github.com"

      - name: Revert specified commit
        run: |
          cd /tmp/source-repo
          git fetch --all
          git revert ${{ github.event.inputs.commit_sha }} --no-edit

      - name: Push changes
        run: |
          cd /tmp/source-repo
          git push origin ${{ github.event.inputs.branch }}